#!/usr/bin/env sh

mode=$1
target=$2

function finish {
  pkill -P $proc_pid
  pkill -P $tauri_pid
  exit 0
}

if [ "$1" = "version" ]
then
  echo "$(${2} --version)"
  exit 0
fi

if [ "$1" = "install" ]
then
  npm install -g "${2}"
  exit 0
fi

if [ "$1" = "run" ]; then
  ${2} & disown
  proc_pid=$!
  tauri_pid=$PPID
  while true
  do
    check=$(ps -p ${tauri_pid})
    if [ "$check" = "" ]
    then
      finish
    fi
    sleep 1
  done
fi

trap finish EXIT